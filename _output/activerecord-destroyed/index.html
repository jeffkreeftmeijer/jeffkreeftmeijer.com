<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8"/>
<title>Checking if an ActiveRecord model instance was destroyed</title>
<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
<meta name="description" content="ActiveRecord::Base#destroyed? was introduced in 2009, about a year before Rails 3.0 was released. Still, almost five years later, I regularly see code that tests a destroy action by querying the database after deleting the record to see if it still exists.">
<meta name="author" content="Jeff Kreeftmeijer">
<link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgo=">
<link rel="alternate" type="application/atom+xml" href="/feed.xml">
<style>body{font:22px/1.6 system-ui,sans-serif;margin:auto;max-width:35em;padding:0 1em}img,video{max-width:100%;height:auto}@media (max-width:1140px){body{font-size:20px}}@media (max-width:740px){body{font-size:18px}}@media (max-width:466px){body{font-size:16px}}code,kbd,pre{font-family:SF Mono,Monaco,monospace}pre{background-color:#f8f8ff;font-size:smaller;overflow:auto;padding:1em}table{border-collapse:collapse;width:100%}td,th{padding:.5em;border:1px solid}nav{display:flex;justify-content:space-between;flex-wrap:wrap;margin:1em 0}figure{margin:0}.byline,.small,figcaption{font-size:smaller}dt{font-weight:600}dd{margin-bottom:1em}.image-block img{display:block;margin:auto}.admonition-block,.sidebarblock{border:1px outset;padding-left:1em;padding-right:1em;margin:1em 0}.admonition-block h6{font-size:1em;margin:1em 0}.warning{background-color:ivory}.caution,.important{background-color:#fff0f5}.note,.tip{background-color:#f0f8ff}.warning h6:before{content:"‚ö†Ô∏è "}.tip h6:before{content:"üí° "}.note h6:before{content:"‚ÑπÔ∏è "}.white{color:#fff}.ad{position:absolute;top:1.34em;left:50%;width:50%;overflow:hidden;z-index:-100}.ad div{display:block;width:130px;margin-left:18.5em}.ad a{text-decoration:none;color:gray;font-size:small;display:block;margin-bottom:1em}.cf-powered-by{font-style:italic}@media (max-width:1040px){.ad{display:none}}</style>

<a id="checking-if-an-activerecord-model-instance-was-destroyed"></a><h1>Checking if an ActiveRecord model instance was destroyed</h1>
<p><time>2014-09-11</time></p>
<p><a href="https://github.com/rails/rails/commit/7034272354ad41dd4d1c90138a79e7f14ebc2bed#diff-391caa9b9464021e932ebf657fa9b13cR2496"><code class="inline">ActiveRecord::Base#destroyed?</code></a> was introduced in 2009, about a year before Rails 3.0 was released. Still, almost five years later, I regularly see code that tests a destroy action by querying the database after deleting the record to see if it still exists:</p>
<pre><code class="ruby language-ruby">delete :destroy
Session.exist?(@session).should.be.false

# or:

lambda {
  delete :destroy
}.should.change(&#39;Session.count&#39; -1)

# or even:

delete :destroy
lambda {
  @session.reload 
}.should.raise(ActiveRecord::RecordNotFound)</code></pre>
<p>By using <code class="inline">ActiveRecord::Base#destroyed?</code>, you can ask ActiveRecord if <code class="inline">#delete</code> or <code class="inline">#destroy</code> was called on that specific object, without having to check the database:</p>
<pre><code class=" language-">describe SessionsController do
  before do
    @session = sessions(:harry)
    cookies[:authorization] = @session.token
  end

  it &quot;logs the user out&quot; do
    delete :destroy
    assigns(:session).should.be.destroyed
  end
end</code></pre>
<p>Be sure to test this on the same instance you called <code class="inline">#delete</code> or <code class="inline">#destroy</code> on, though. Calling <code class="inline">#destroyed?</code> on <code class="inline">@session</code> instead of <code class="inline">assigns(:session)</code> in the above example would return <code class="inline">false</code>. That‚Äôs because <code class="inline">#destroy</code> and <code class="inline">#delete</code> actually set a <code class="inline">@destroyed</code> flag on the object, which is returned when you call <code class="inline">#destroyed?</code>.</p>

<aside class="ad" id="codefund_ad">
  <script async src="https://codefund.io/scripts/48fc837b-75ff-48f2-9cf2-3f52281d7721/embed.js"></script>
  <script>window._codefund_theme = '';</script>
</aside>

<hr/>
<nav>
  
    <a href="/" rel="author">Jeff Kreeftmeijer</a>
  
  <a rel="nofollow" href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#106;&#101;&#102;&#102;&#107;&#114;&#101;&#101;&#102;&#116;&#109;&#101;&#105;&#106;&#101;&#114;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;">E-mail</a>
  <a rel="me" href="https://twitter.com/jkreeftmeijer">Twitter</a>
  <a rel="me" href="https://github.com/jeffkreeftmeijer">Github</a>
  <a href="/feed.xml">RSS</a>
</nav>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-12888762-1', 'auto');
  ga('send', 'pageview');
</script>
</html>
